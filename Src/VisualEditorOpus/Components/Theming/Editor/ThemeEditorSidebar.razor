@* Theme editor sidebar with scrollable sections *@
@implements IDisposable

@using VisualEditorOpus.Services.Theming
@using VisualEditorOpus.Components.Theming.Editor.Sections

<div class="theme-editor-sidebar @(IsOpen ? "open" : "")">
    <div class="sidebar-header">
        <span class="sidebar-title">Theme Settings</span>
        <button type="button" class="sidebar-close mobile-only" @onclick="HandleClose" title="Close Sidebar">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>

    <div class="sidebar-content">
        @if (ThemeState.CurrentTheme is null)
        {
            <div class="sidebar-empty">
                <i class="bi bi-palette"></i>
                <span>No theme loaded</span>
            </div>
        }
        else
        {
            <ThemePresetSection />
            <ColorsSection />
            <TypographySection />
            <SpacingSection />
            <BordersSection />
            <ShadowsSection />
            <HeaderSection />
            <BackgroundSection />
            <ComponentsSection />
            <ThemeAccessibilitySection />
        }
    </div>
</div>

@code {
    [Inject] private IThemeEditorStateService ThemeState { get; set; } = default!;

    [Parameter] public bool IsOpen { get; set; } = true;
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }

    protected override void OnInitialized()
    {
        ThemeState.OnThemeChanged += HandleThemeChanged;
    }

    private void HandleThemeChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    private async Task HandleClose()
    {
        await IsOpenChanged.InvokeAsync(false);
    }

    public void Dispose()
    {
        ThemeState.OnThemeChanged -= HandleThemeChanged;
    }
}
