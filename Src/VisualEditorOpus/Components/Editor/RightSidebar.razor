@* Right sidebar showing properties panel *@
@implements IDisposable

<div class="right-sidebar">
    @if (EditorState.SelectedField is not null)
    {
        <div class="sidebar-header" style="background: var(--bg-secondary);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: 600; font-size: 13px;">Properties</span>
                <Badge Variant="primary" Text="@EditorState.SelectedField.Id" />
            </div>
        </div>
        <div style="flex: 1; overflow-y: auto;">
            <GeneralSection />
            @if (HasTypeConfig)
            {
                <TypeConfigButton />
            }
            <LabelsSection />
            @if (IsChoiceField)
            {
                <EnhancedOptionsSection />
            }
            <ValidationSection />
            <ConditionalSection />
            <LayoutSection />
            <DatabaseSection />
        </div>
    }
    else
    {
        <div class="sidebar-header" style="background: var(--bg-secondary);">
            <span style="font-weight: 600; font-size: 13px;">Properties</span>
        </div>
        <div style="flex: 1; display: flex; align-items: center; justify-content: center; color: var(--text-muted); padding: 20px; text-align: center;">
            <div>
                <i class="bi bi-cursor" style="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px;"></i>
                <span>Select a field to view properties</span>
            </div>
        </div>
    }
</div>

@code {
    [Inject] private IEditorStateService EditorState { get; set; } = default!;

    private bool IsChoiceField => EditorState.SelectedField?.FieldType is "DropDown" or "RadioGroup" or "CheckboxList";

    private bool HasTypeConfig => EditorState.SelectedField?.FieldType is
        "TextBox" or "Email" or "Phone" or
        "Number" or "Currency" or
        "DatePicker" or "DateTime" or "Time" or
        "FileUpload" or "Image" or "Signature" or
        "DataGrid" or "Repeater" or "AutoComplete";

    protected override void OnInitialized()
    {
        EditorState.OnStateChanged += StateHasChanged;
        EditorState.OnFieldSelected += OnFieldSelected;
    }

    private void OnFieldSelected(string? fieldId)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        EditorState.OnStateChanged -= StateHasChanged;
        EditorState.OnFieldSelected -= OnFieldSelected;
    }
}
