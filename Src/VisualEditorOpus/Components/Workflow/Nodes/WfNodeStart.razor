@namespace VisualEditorOpus.Components.Workflow.Nodes

<WfNodeBase
    Id="@Id"
    Title="@(string.IsNullOrEmpty(Node?.Name) ? "Start" : Node.Name)"
    IconName="play-fill"
    Position="@Position"
    IsSelected="@IsSelected"
    HasTopHandle="false"
    HasBottomHandle="true"
    HasLeftHandle="false"
    HasRightHandle="false"
    NodeTypeClass="wf-node-start"
    OnSelected="OnSelected"
    OnPositionChanged="OnPositionChanged"
    OnConnectionStart="OnConnectionStart"
    OnMenuRequested="OnMenuRequested">

    <ChildContent>
        <div class="start-trigger">
            @GetTriggerDescription()
        </div>
    </ChildContent>

    <FooterContent>
        <span>Trigger: @GetTriggerType()</span>
    </FooterContent>
</WfNodeBase>

@code {
    [Parameter] public string Id { get; set; } = "";
    [Parameter] public WorkflowNodeData? Node { get; set; }
    [Parameter] public WfPoint Position { get; set; } = WfPoint.Zero;
    [Parameter] public bool IsSelected { get; set; }

    [Parameter] public EventCallback<string> OnSelected { get; set; }
    [Parameter] public EventCallback<(string NodeId, WfPoint Position)> OnPositionChanged { get; set; }
    [Parameter] public EventCallback<(string NodeId, HandlePosition Handle)> OnConnectionStart { get; set; }
    [Parameter] public EventCallback OnMenuRequested { get; set; }

    private string GetTriggerType()
    {
        return Node?.TriggerType switch
        {
            Models.TriggerType.OnSubmit => "On Submit",
            Models.TriggerType.OnSave => "On Save",
            Models.TriggerType.OnLoad => "On Load",
            Models.TriggerType.Manual => "Manual",
            Models.TriggerType.Scheduled => "Scheduled",
            _ => "On Submit"
        };
    }

    private string GetTriggerDescription()
    {
        return Node?.TriggerType switch
        {
            Models.TriggerType.OnSubmit => "Workflow begins when form is submitted",
            Models.TriggerType.OnSave => "Workflow begins when form is saved",
            Models.TriggerType.OnLoad => "Workflow begins when form loads",
            Models.TriggerType.Manual => "Workflow is triggered manually",
            Models.TriggerType.Scheduled => $"Runs on schedule: {Node?.ScheduleCron}",
            _ => "Workflow begins here"
        };
    }
}
