@using DynamicForms.Editor.Services
@implements IDisposable

<div class="toast @LevelClass" style="@(IsVisible ? "" : "display:none")">
    <i class="bi @IconClass"></i>
    <span>@Message</span>
</div>

@code {
    [Parameter] public string Message { get; set; } = "";
    [Parameter] public ToastLevel Level { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private bool IsVisible { get; set; } = true;

    private string LevelClass => Level switch
    {
        ToastLevel.Info => "toast-info",
        ToastLevel.Success => "toast-success",
        ToastLevel.Warning => "toast-warning",
        ToastLevel.Error => "toast-error",
        _ => "toast-info"
    };

    private string IconClass => Level switch
    {
        ToastLevel.Info => "bi-info-circle-fill",
        ToastLevel.Success => "bi-check-circle-fill",
        ToastLevel.Warning => "bi-exclamation-triangle-fill",
        ToastLevel.Error => "bi-x-circle-fill",
        _ => "bi-info-circle-fill"
    };

    protected override void OnInitialized()
    {
        // Auto-close after 3 seconds
        var timer = new System.Timers.Timer(3000);
        timer.Elapsed += (s, e) =>
        {
            IsVisible = false;
            OnClose.InvokeAsync();
            timer.Dispose();
            InvokeAsync(StateHasChanged);
        };
        timer.Start();
    }
    
    public void Dispose()
    {
        // Timer disposal is handled in callback
    }
}
