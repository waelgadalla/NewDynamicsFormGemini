@using DynamicForms.Editor.Services
@inject EditorStateService EditorState
@implements IDisposable

<div class="editor-canvas">
    <div class="form-title">
        <h3>@EditorState.CurrentModule.TitleEn</h3>
        <p class="text-muted">@EditorState.CurrentModule.DescriptionEn</p>
    </div>

    @foreach (var field in EditorState.GetChildren(null))
    {
        <CanvasItem Field="@field" />
    }

    @if (!EditorState.GetChildren(null).Any())
    {
        <div class="empty-canvas-state">
            <p>Your form is empty.</p>
            <p class="small">Select a field from the toolbox to start.</p>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        EditorState.OnModuleChanged += StateHasChanged;
        EditorState.OnSelectionChanged += StateHasChanged;
    }

    public void Dispose()
    {
        EditorState.OnModuleChanged -= StateHasChanged;
        EditorState.OnSelectionChanged -= StateHasChanged;
    }
}
