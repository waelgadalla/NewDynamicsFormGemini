<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConfirmDeleteModal - Testing Guide</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --primary-light: #EEF2FF;
            --success: #10B981;
            --success-light: #D1FAE5;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --info: #3B82F6;
            --info-light: #DBEAFE;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: #F1F5F9;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border-color: #E2E8F0;
            --border-strong: #CBD5E1;
            --font-sans: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 40px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1 i { color: var(--danger); }

        .subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 32px;
        }

        h2 {
            font-size: 20px;
            margin: 32px 0 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--danger);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2 i { color: var(--danger); font-size: 18px; }

        h3 {
            font-size: 16px;
            margin: 24px 0 12px;
            color: var(--text-primary);
        }

        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .checklist li:last-child {
            border-bottom: none;
        }

        .checklist input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: var(--danger);
            cursor: pointer;
        }

        .checklist label {
            flex: 1;
            cursor: pointer;
        }

        .checklist .item-title {
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .checklist .item-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .code-block {
            background: #1E293B;
            color: #E2E8F0;
            padding: 16px;
            border-radius: var(--radius-md);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .file-path {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-family: monospace;
            font-size: 12px;
            color: var(--text-secondary);
            margin: 8px 0;
        }

        .file-path i { color: var(--danger); }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success { background: var(--success-light); color: var(--success); }
        .badge-warning { background: var(--warning-light); color: var(--warning); }
        .badge-info { background: var(--info-light); color: var(--info); }
        .badge-danger { background: var(--danger-light); color: var(--danger); }

        .progress-bar {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            height: 8px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--danger);
            border-radius: var(--radius-md);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .note {
            background: var(--info-light);
            border-left: 4px solid var(--info);
            padding: 12px 16px;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 16px 0;
            font-size: 14px;
        }

        .warning {
            background: var(--warning-light);
            border-left: 4px solid var(--warning);
            padding: 12px 16px;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 16px 0;
            font-size: 14px;
        }

        .test-steps ol {
            padding-left: 0;
            list-style: none;
        }

        .test-steps li {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }

        .test-steps .step-content {
            flex: 1;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }

        .summary-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .summary-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--danger);
        }

        .summary-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        kbd {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 2px 6px;
            font-size: 12px;
            font-family: inherit;
        }

        ul { margin-left: 20px; margin-top: 8px; }
        ul li { margin-bottom: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="bi bi-trash"></i> ConfirmDeleteModal - Testing Guide</h1>
        <p class="subtitle">Confirmation dialog for delete operations - testing and verification</p>

        <!-- Progress Summary -->
        <div class="card">
            <h3>Testing Progress</h3>
            <div class="progress-text"><span id="progressCount">0</span> of <span id="totalCount">15</span> tests completed</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-number" id="passedCount">0</div>
                    <div class="summary-label">Tests Passed</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="remainingCount">15</div>
                    <div class="summary-label">Remaining</div>
                </div>
            </div>
        </div>

        <!-- Section 1: Manual Testing Steps -->
        <h2><i class="bi bi-list-check"></i> Section 1: Manual Testing Steps</h2>

        <div class="card">
            <h3>1.1 Simple Delete Confirmation</h3>
            <div class="test-steps">
                <ol>
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Basic modal open/close</strong><br>
                            Create a test page with the following code and verify modal opens:
                            <div class="code-block">&lt;button @onclick="() => showDelete = true"&gt;Delete&lt;/button&gt;

&lt;ConfirmDeleteModal @bind-IsOpen="showDelete"
                    Title="Delete Field"
                    ItemName="firstName"
                    OnConfirm="HandleDelete"
                    OnCancel="() => showDelete = false" /&gt;</div>
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Verify visual elements</strong><br>
                            Check that the modal displays:
                            <ul>
                                <li>Circular red trash icon at top</li>
                                <li>"Are you sure?" title</li>
                                <li>Message text</li>
                                <li>Item name in monospace box</li>
                                <li>Cancel and Delete buttons in footer</li>
                            </ul>
                        </div>
                    </li>
                </ol>
            </div>
        </div>

        <div class="card">
            <h3>1.2 Delete with Warning Message</h3>
            <div class="test-steps">
                <ol>
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Add WarningMessage parameter</strong><br>
                            <div class="code-block">&lt;ConfirmDeleteModal @bind-IsOpen="showDelete"
                    Title="Delete Module"
                    ItemName="PersonalInfo"
                    WarningMessage="This module contains 12 fields that will be deleted."
                    OnConfirm="HandleDelete" /&gt;</div>
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Verify warning display</strong><br>
                            Check that the warning box appears with:
                            <ul>
                                <li>Yellow/warning background color</li>
                                <li>Warning triangle icon</li>
                                <li>Warning message text</li>
                            </ul>
                        </div>
                    </li>
                </ol>
            </div>
        </div>

        <div class="card">
            <h3>1.3 Delete with Child Items List</h3>
            <div class="test-steps">
                <ol>
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Add ChildItems parameter</strong><br>
                            <div class="code-block">@code {
    private List&lt;DeleteChildItem&gt; childItems = new()
    {
        new("firstName", "bi-input-cursor-text"),
        new("lastName", "bi-input-cursor-text"),
        new("email", "bi-envelope")
    };
}

&lt;ConfirmDeleteModal @bind-IsOpen="showDelete"
                    ChildItems="childItems"
                    ... /&gt;</div>
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Verify children list</strong><br>
                            Check that the children list shows:
                            <ul>
                                <li>Title with count: "Items to be deleted (3)"</li>
                                <li>Each child with its icon and name</li>
                                <li>List scrolls if many items</li>
                            </ul>
                        </div>
                    </li>
                </ol>
            </div>
        </div>

        <div class="card">
            <h3>1.4 Loading State (IsDeleting)</h3>
            <div class="test-steps">
                <ol>
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Implement loading state</strong><br>
                            <div class="code-block">private bool isDeleting = false;

private async Task HandleDelete()
{
    isDeleting = true;
    StateHasChanged();

    await Task.Delay(2000); // Simulate API call

    isDeleting = false;
    showDelete = false;
}

&lt;ConfirmDeleteModal IsDeleting="@isDeleting" ... /&gt;</div>
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Verify loading behavior</strong><br>
                            When IsDeleting is true:
                            <ul>
                                <li>Delete button shows spinner animation</li>
                                <li>Both buttons are disabled</li>
                                <li>Backdrop click does not close modal</li>
                                <li>ESC key does not close modal</li>
                            </ul>
                        </div>
                    </li>
                </ol>
            </div>
        </div>

        <div class="card">
            <h3>1.5 Keyboard Interactions</h3>
            <div class="test-steps">
                <ol>
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Test ESC key</strong><br>
                            Open the modal and press <kbd>Esc</kbd>. Modal should close (when not deleting).
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Test Tab navigation</strong><br>
                            Use <kbd>Tab</kbd> to navigate between Cancel and Delete buttons.
                        </div>
                    </li>
                    <li>
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <strong>Verify keyboard hint</strong><br>
                            Check that footer shows "<kbd>Esc</kbd> to cancel" hint text.
                        </div>
                    </li>
                </ol>
            </div>
        </div>

        <div class="card">
            <h3>1.6 Dark Mode Testing</h3>
            <div class="test-steps">
                <ol>
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Enable dark mode</strong><br>
                            Set data-theme="dark" on body element.
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Verify styling</strong><br>
                            Check all elements adapt to dark theme:
                            <ul>
                                <li>Modal background</li>
                                <li>Text colors</li>
                                <li>Warning box colors</li>
                                <li>Item name box</li>
                                <li>Button styles</li>
                            </ul>
                        </div>
                    </li>
                </ol>
            </div>
        </div>

        <!-- Section 2: Manual Implementation Tasks -->
        <h2><i class="bi bi-tools"></i> Section 2: Manual Implementation Tasks</h2>

        <div class="card">
            <h3>2.1 Files Created</h3>
            <p>The following files have been created:</p>

            <div class="file-path"><i class="bi bi-file-code"></i> Src/VisualEditorOpus/Models/DeleteChildItem.cs</div>
            <p>Record type for representing child items to be deleted.</p>

            <div class="file-path"><i class="bi bi-file-code"></i> Src/VisualEditorOpus/Components/Shared/ConfirmDeleteModal.razor</div>
            <p>Main component with all parameters and event handlers.</p>

            <div class="file-path"><i class="bi bi-file-code"></i> Src/VisualEditorOpus/Components/Shared/ConfirmDeleteModal.razor.css</div>
            <p>Scoped styles for the delete modal.</p>
        </div>

        <div class="card">
            <h3>2.2 Integration Tasks</h3>
            <ul class="checklist">
                <li>
                    <input type="checkbox" id="task1">
                    <label for="task1">
                        <span class="item-title">Verify _Imports.razor includes VisualEditorOpus.Models</span>
                        <span class="item-desc">Ensure DeleteChildItem is accessible in components</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="task2">
                    <label for="task2">
                        <span class="item-title">Integrate with EditorStateService</span>
                        <span class="item-desc">Wire up delete operations for fields, modules, etc.</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="task3">
                    <label for="task3">
                        <span class="item-title">Integrate with ToastService</span>
                        <span class="item-desc">Show success/error toast messages after delete operations</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="task4">
                    <label for="task4">
                        <span class="item-title">Add delete confirmation to field context menu</span>
                        <span class="item-desc">Wire up delete prompt in canvas/outline field actions</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="task5">
                    <label for="task5">
                        <span class="item-title">Add delete confirmation to module actions</span>
                        <span class="item-desc">Wire up delete prompt in module editor/workflow</span>
                    </label>
                </li>
            </ul>
        </div>

        <div class="card">
            <h3>2.3 Common Integration Pattern</h3>
            <p>Use this pattern in parent components:</p>
            <div class="code-block">@* In parent component *@
private bool showDeleteModal = false;
private FormFieldSchema? fieldToDelete;
private bool isDeleting = false;

private void PromptDelete(FormFieldSchema field)
{
    fieldToDelete = field;
    showDeleteModal = true;
}

private async Task HandleDelete()
{
    if (fieldToDelete == null) return;

    isDeleting = true;
    StateHasChanged();

    try
    {
        await EditorStateService.DeleteFieldAsync(fieldToDelete.Id);
        showDeleteModal = false;
        ToastService.ShowSuccess("Field deleted successfully");
    }
    catch (Exception ex)
    {
        ToastService.ShowError($"Delete failed: {ex.Message}");
    }
    finally
    {
        isDeleting = false;
        fieldToDelete = null;
    }
}

&lt;ConfirmDeleteModal @bind-IsOpen="showDeleteModal"
                    Title="Delete Field"
                    ItemName="@(fieldToDelete?.Id ?? "")"
                    IsDeleting="@isDeleting"
                    OnConfirm="HandleDelete"
                    OnCancel="() => showDeleteModal = false" /&gt;</div>
        </div>

        <!-- Section 3: Verification Checklist -->
        <h2><i class="bi bi-check2-square"></i> Section 3: Verification Checklist</h2>

        <div class="card">
            <ul class="checklist" id="verificationChecklist">
                <li>
                    <input type="checkbox" id="v1" onchange="updateProgress()">
                    <label for="v1">
                        <span class="item-title">Modal opens and closes correctly</span>
                        <span class="item-desc">IsOpen binding works, modal animates in/out</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v2" onchange="updateProgress()">
                    <label for="v2">
                        <span class="item-title">ESC key closes modal (when not deleting)</span>
                        <span class="item-desc">CloseOnEscape behavior from ModalBase works</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v3" onchange="updateProgress()">
                    <label for="v3">
                        <span class="item-title">Cancel button closes modal</span>
                        <span class="item-desc">OnCancel callback is invoked, modal closes</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v4" onchange="updateProgress()">
                    <label for="v4">
                        <span class="item-title">Confirm button triggers OnConfirm callback</span>
                        <span class="item-desc">Delete action is executed when button clicked</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v5" onchange="updateProgress()">
                    <label for="v5">
                        <span class="item-title">Loading state shows spinner on button</span>
                        <span class="item-desc">Delete button displays spinning animation</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v6" onchange="updateProgress()">
                    <label for="v6">
                        <span class="item-title">Loading state disables both buttons</span>
                        <span class="item-desc">Cancel and Delete buttons are not clickable</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v7" onchange="updateProgress()">
                    <label for="v7">
                        <span class="item-title">Loading state prevents backdrop click close</span>
                        <span class="item-desc">CloseOnBackdropClick is false during delete</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v8" onchange="updateProgress()">
                    <label for="v8">
                        <span class="item-title">Danger icon displays in circular background</span>
                        <span class="item-desc">Red trash icon with light red circular background</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v9" onchange="updateProgress()">
                    <label for="v9">
                        <span class="item-title">Warning message displays when provided</span>
                        <span class="item-desc">Yellow warning box with icon appears</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v10" onchange="updateProgress()">
                    <label for="v10">
                        <span class="item-title">Children list displays when provided</span>
                        <span class="item-desc">List shows items with icons and names</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v11" onchange="updateProgress()">
                    <label for="v11">
                        <span class="item-title">Item name displays in monospace box</span>
                        <span class="item-desc">Gray background box with monospace font</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v12" onchange="updateProgress()">
                    <label for="v12">
                        <span class="item-title">Keyboard hint shows in footer</span>
                        <span class="item-desc">"Esc to cancel" text with kbd styling</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v13" onchange="updateProgress()">
                    <label for="v13">
                        <span class="item-title">Custom button text works</span>
                        <span class="item-desc">ConfirmButtonText and CancelButtonText parameters</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v14" onchange="updateProgress()">
                    <label for="v14">
                        <span class="item-title">Dark mode styling correct</span>
                        <span class="item-desc">All colors adapt to dark theme</span>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="v15" onchange="updateProgress()">
                    <label for="v15">
                        <span class="item-title">Integration with ModalBase works</span>
                        <span class="item-desc">Uses ModalBase internally, inherits behavior</span>
                    </label>
                </li>
            </ul>
        </div>

        <div class="note">
            <strong>Tip:</strong> Test with different item names including long names and special characters to ensure proper display and word-break behavior.
        </div>

        <div class="warning">
            <strong>Important:</strong> Always set IsDeleting=true before starting delete operations and IsDeleting=false when complete to prevent users from accidentally triggering multiple deletes.
        </div>
    </div>

    <script>
        function updateProgress() {
            const checkboxes = document.querySelectorAll('#verificationChecklist input[type="checkbox"]');
            const total = checkboxes.length;
            let checked = 0;

            checkboxes.forEach(cb => {
                if (cb.checked) checked++;
            });

            const percentage = Math.round((checked / total) * 100);

            document.getElementById('progressCount').textContent = checked;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('passedCount').textContent = checked;
            document.getElementById('remainingCount').textContent = total - checked;
            document.getElementById('progressFill').style.width = percentage + '%';

            // Save progress to localStorage
            const state = {};
            checkboxes.forEach(cb => {
                state[cb.id] = cb.checked;
            });
            localStorage.setItem('confirmdelete-testing-progress', JSON.stringify(state));
        }

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('confirmdelete-testing-progress');
            if (saved) {
                const state = JSON.parse(saved);
                Object.keys(state).forEach(id => {
                    const cb = document.getElementById(id);
                    if (cb) cb.checked = state[id];
                });
                updateProgress();
            }
        }

        loadProgress();
    </script>
</body>
</html>
