<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D.3 JSON Preview - Mockup</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #6366F1;
            --primary-light: rgba(99, 102, 241, 0.1);
            --primary-hover: #5558E3;
            --success: #10B981;
            --success-light: rgba(16, 185, 129, 0.1);
            --warning: #F59E0B;
            --warning-light: rgba(245, 158, 11, 0.1);
            --error: #EF4444;
            --error-light: rgba(239, 68, 68, 0.1);
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --bg-tertiary: #F3F4F6;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --border-color: #E5E7EB;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            /* JSON syntax colors */
            --json-key: #0550AE;
            --json-string: #0A3069;
            --json-number: #0550AE;
            --json-boolean: #CF222E;
            --json-null: #8250DF;
            --json-bracket: #24292F;
        }

        [data-theme="dark"] {
            --primary: #818CF8;
            --primary-light: rgba(129, 140, 248, 0.15);
            --bg-primary: #1F2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --text-muted: #9CA3AF;
            --border-color: #374151;
            /* JSON syntax colors - dark mode */
            --json-key: #79C0FF;
            --json-string: #A5D6FF;
            --json-number: #79C0FF;
            --json-boolean: #FF7B72;
            --json-null: #D2A8FF;
            --json-bracket: #C9D1D9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 24px;
            transition: background 0.3s, color 0.3s;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
        }

        .page-title span {
            color: var(--primary);
        }

        .theme-toggle {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ===== JSON PREVIEW CONTAINER ===== */
        .json-preview-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        /* ===== JSON TOOLBAR ===== */
        .json-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .json-toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .json-stats {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .json-toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .toolbar-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light);
        }

        .toolbar-btn.primary {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .toolbar-btn.primary:hover {
            background: var(--primary-hover);
        }

        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: var(--border-color);
        }

        /* ===== VIEW MODE TOGGLE ===== */
        .view-toggle {
            display: flex;
            gap: 2px;
            padding: 3px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
        }

        .view-toggle-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .view-toggle-btn.active {
            background: var(--bg-primary);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        /* ===== JSON EDITOR AREA ===== */
        .json-editor-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Line Numbers */
        .line-numbers {
            width: 50px;
            background: var(--bg-tertiary);
            border-right: 1px solid var(--border-color);
            padding: 16px 0;
            overflow: hidden;
            user-select: none;
        }

        .line-number {
            height: 24px;
            line-height: 24px;
            font-size: 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            color: var(--text-muted);
            text-align: right;
            padding-right: 12px;
        }

        .line-number.error {
            background: var(--error-light);
            color: var(--error);
        }

        /* JSON Content */
        .json-content {
            flex: 1;
            padding: 16px;
            overflow: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 24px;
        }

        .json-content.editable {
            white-space: pre-wrap;
            word-break: break-all;
            outline: none;
        }

        .json-content.editable:focus {
            background: var(--bg-secondary);
        }

        /* JSON Syntax Highlighting */
        .json-key {
            color: var(--json-key);
        }

        .json-string {
            color: var(--json-string);
        }

        .json-number {
            color: var(--json-number);
        }

        .json-boolean {
            color: var(--json-boolean);
        }

        .json-null {
            color: var(--json-null);
        }

        .json-bracket {
            color: var(--json-bracket);
        }

        /* Collapsible sections */
        .json-collapsible {
            cursor: pointer;
        }

        .json-collapsible::before {
            content: 'â–¼';
            display: inline-block;
            width: 12px;
            font-size: 10px;
            transition: transform 0.2s;
        }

        .json-collapsible.collapsed::before {
            transform: rotate(-90deg);
        }

        .json-collapsible.collapsed + .json-nested {
            display: none;
        }

        .json-nested {
            padding-left: 20px;
        }

        .json-preview {
            color: var(--text-muted);
            font-style: italic;
        }

        /* ===== SEARCH BAR ===== */
        .search-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .search-bar.hidden {
            display: none;
        }

        .search-input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
        }

        .search-input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .search-input-wrapper i {
            color: var(--text-muted);
        }

        .search-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 13px;
            color: var(--text-primary);
            outline: none;
        }

        .search-count {
            font-size: 12px;
            color: var(--text-muted);
            padding: 0 8px;
        }

        .search-nav {
            display: flex;
            gap: 4px;
        }

        .search-nav button {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-secondary);
        }

        .search-nav button:hover {
            background: var(--bg-tertiary);
        }

        .search-close {
            padding: 4px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 18px;
        }

        /* Search highlight */
        .search-highlight {
            background: var(--warning-light);
            border-radius: 2px;
        }

        .search-highlight.current {
            background: var(--warning);
            color: white;
        }

        /* ===== STATUS BAR ===== */
        .json-status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border-color);
            font-size: 12px;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .status-valid {
            color: var(--success);
        }

        .status-invalid {
            color: var(--error);
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .cursor-position {
            color: var(--text-muted);
        }

        /* ===== VALIDATION PANEL ===== */
        .validation-panel {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            max-height: 150px;
            overflow: auto;
        }

        .validation-panel.hidden {
            display: none;
        }

        .validation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: var(--error-light);
            border-bottom: 1px solid var(--border-color);
        }

        .validation-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--error);
        }

        .validation-close {
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 16px;
        }

        .validation-list {
            padding: 8px 16px;
        }

        .validation-error {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .validation-error:hover {
            background: var(--bg-tertiary);
        }

        .validation-error i {
            color: var(--error);
            margin-top: 2px;
        }

        .validation-error-content {
            flex: 1;
        }

        .validation-error-msg {
            font-size: 13px;
            color: var(--text-primary);
        }

        .validation-error-loc {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* ===== MINIMAP ===== */
        .minimap {
            width: 100px;
            background: var(--bg-tertiary);
            border-left: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .minimap-content {
            font-size: 2px;
            line-height: 3px;
            padding: 8px;
            white-space: pre;
            color: var(--text-muted);
            opacity: 0.6;
        }

        .minimap-viewport {
            position: absolute;
            left: 0;
            right: 0;
            background: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: 2px;
            pointer-events: none;
        }

        /* ===== DIFF VIEW ===== */
        .diff-view {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .diff-view.active {
            display: flex;
        }

        .diff-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .diff-pane:first-child {
            border-right: 1px solid var(--border-color);
        }

        .diff-header {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .diff-content {
            flex: 1;
            overflow: auto;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 24px;
        }

        .diff-line {
            padding: 0 8px;
            margin: 0 -8px;
        }

        .diff-line.added {
            background: var(--success-light);
        }

        .diff-line.removed {
            background: var(--error-light);
        }

        .diff-line.modified {
            background: var(--warning-light);
        }

        /* ===== PATH NAVIGATOR ===== */
        .path-navigator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .path-navigator.hidden {
            display: none;
        }

        .path-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
        }

        .path-item:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .path-separator {
            color: var(--text-muted);
        }

        .path-current {
            font-weight: 600;
            color: var(--primary);
            background: var(--primary-light);
            border-color: var(--primary);
        }

        /* ===== DEMO CONTROLS ===== */
        .demo-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .demo-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .demo-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
        }

        .demo-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* ===== TOAST NOTIFICATION ===== */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--text-primary);
            color: var(--bg-primary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: var(--success);
            color: white;
        }

        .toast.error {
            background: var(--error);
            color: white;
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1 class="page-title">D.3 <span>JSON Preview</span> - Mockup</h1>
        <button class="theme-toggle" onclick="toggleTheme()">
            <i class="bi bi-moon"></i>
            Toggle Theme
        </button>
    </div>

    <!-- Demo Controls -->
    <div class="demo-controls">
        <button class="demo-btn" onclick="toggleSearch()">
            <i class="bi bi-search"></i> Toggle Search (Ctrl+F)
        </button>
        <button class="demo-btn" onclick="toggleValidation()">
            <i class="bi bi-exclamation-triangle"></i> Toggle Errors
        </button>
        <button class="demo-btn" onclick="togglePathNav()">
            <i class="bi bi-signpost"></i> Toggle Path Nav
        </button>
        <button class="demo-btn" onclick="copyJson()">
            <i class="bi bi-clipboard"></i> Copy JSON
        </button>
        <button class="demo-btn" onclick="formatJson()">
            <i class="bi bi-code-square"></i> Format JSON
        </button>
        <button class="demo-btn" onclick="collapseAll()">
            <i class="bi bi-arrows-collapse"></i> Collapse All
        </button>
        <button class="demo-btn" onclick="expandAll()">
            <i class="bi bi-arrows-expand"></i> Expand All
        </button>
    </div>

    <!-- JSON Preview Container -->
    <div class="json-preview-container">
        <!-- Toolbar -->
        <div class="json-toolbar">
            <div class="json-toolbar-left">
                <div class="view-toggle">
                    <button class="view-toggle-btn active" onclick="setViewMode('formatted')">
                        Formatted
                    </button>
                    <button class="view-toggle-btn" onclick="setViewMode('raw')">
                        Raw
                    </button>
                    <button class="view-toggle-btn" onclick="setViewMode('diff')">
                        Diff
                    </button>
                </div>
                <div class="json-stats">
                    <span class="stat-item">
                        <i class="bi bi-file-code"></i>
                        <span class="stat-value">2.4 KB</span>
                    </span>
                    <span class="stat-item">
                        <i class="bi bi-list-ol"></i>
                        <span class="stat-value">98 lines</span>
                    </span>
                    <span class="stat-item">
                        <i class="bi bi-diagram-3"></i>
                        <span class="stat-value">12 fields</span>
                    </span>
                </div>
            </div>
            <div class="json-toolbar-right">
                <button class="toolbar-btn" onclick="toggleSearch()">
                    <i class="bi bi-search"></i>
                    Search
                </button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" onclick="copyJson()">
                    <i class="bi bi-clipboard"></i>
                    Copy
                </button>
                <button class="toolbar-btn" onclick="downloadJson()">
                    <i class="bi bi-download"></i>
                    Download
                </button>
                <button class="toolbar-btn primary" onclick="importJson()">
                    <i class="bi bi-upload"></i>
                    Import
                </button>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="search-bar hidden" id="searchBar">
            <div class="search-input-wrapper">
                <i class="bi bi-search"></i>
                <input type="text" class="search-input" placeholder="Search in JSON..." id="searchInput">
            </div>
            <span class="search-count">3 of 8 matches</span>
            <div class="search-nav">
                <button title="Previous (Shift+Enter)"><i class="bi bi-chevron-up"></i></button>
                <button title="Next (Enter)"><i class="bi bi-chevron-down"></i></button>
            </div>
            <button class="search-close" onclick="toggleSearch()">&times;</button>
        </div>

        <!-- Path Navigator -->
        <div class="path-navigator hidden" id="pathNav">
            <span class="path-item"><i class="bi bi-house"></i> root</span>
            <span class="path-separator"><i class="bi bi-chevron-right"></i></span>
            <span class="path-item">fields</span>
            <span class="path-separator"><i class="bi bi-chevron-right"></i></span>
            <span class="path-item">[0]</span>
            <span class="path-separator"><i class="bi bi-chevron-right"></i></span>
            <span class="path-item path-current">options</span>
        </div>

        <!-- Editor Area -->
        <div class="json-editor-area" id="editorArea">
            <!-- Line Numbers -->
            <div class="line-numbers" id="lineNumbers">
                <!-- Generated by JS -->
            </div>

            <!-- JSON Content -->
            <div class="json-content" id="jsonContent">
                <!-- Generated by JS -->
            </div>

            <!-- Minimap -->
            <div class="minimap">
                <div class="minimap-viewport" style="top: 0; height: 40px;"></div>
                <div class="minimap-content" id="minimapContent">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>

        <!-- Diff View (hidden by default) -->
        <div class="diff-view" id="diffView">
            <div class="diff-pane">
                <div class="diff-header">
                    <i class="bi bi-file-earmark-code"></i> Original (Saved)
                </div>
                <div class="diff-content">
                    <div class="diff-line">{</div>
                    <div class="diff-line">  "id": "form-001",</div>
                    <div class="diff-line removed">  "name": "Employee Survey",</div>
                    <div class="diff-line">  "version": "1.0.0",</div>
                    <div class="diff-line">  ...</div>
                    <div class="diff-line">}</div>
                </div>
            </div>
            <div class="diff-pane">
                <div class="diff-header">
                    <i class="bi bi-file-earmark-code-fill"></i> Current (Unsaved)
                </div>
                <div class="diff-content">
                    <div class="diff-line">{</div>
                    <div class="diff-line">  "id": "form-001",</div>
                    <div class="diff-line added">  "name": "Updated Employee Survey",</div>
                    <div class="diff-line">  "version": "1.0.0",</div>
                    <div class="diff-line added">  "description": "New description added",</div>
                    <div class="diff-line">  ...</div>
                    <div class="diff-line">}</div>
                </div>
            </div>
        </div>

        <!-- Validation Panel -->
        <div class="validation-panel hidden" id="validationPanel">
            <div class="validation-header">
                <span class="validation-title">
                    <i class="bi bi-exclamation-circle-fill"></i>
                    2 Errors Found
                </span>
                <button class="validation-close" onclick="toggleValidation()">&times;</button>
            </div>
            <div class="validation-list">
                <div class="validation-error" onclick="goToLine(15)">
                    <i class="bi bi-x-circle-fill"></i>
                    <div class="validation-error-content">
                        <div class="validation-error-msg">Expected comma after property value</div>
                        <div class="validation-error-loc">Line 15, Column 8</div>
                    </div>
                </div>
                <div class="validation-error" onclick="goToLine(42)">
                    <i class="bi bi-x-circle-fill"></i>
                    <div class="validation-error-content">
                        <div class="validation-error-msg">Unexpected token '}' at position 1234</div>
                        <div class="validation-error-loc">Line 42, Column 1</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="json-status-bar">
            <div class="status-left">
                <span class="status-item status-valid" id="validationStatus">
                    <i class="bi bi-check-circle-fill"></i>
                    Valid JSON
                </span>
                <span class="status-item">
                    <i class="bi bi-clock"></i>
                    Last modified: 2 min ago
                </span>
            </div>
            <div class="status-right">
                <span class="cursor-position">Ln 1, Col 1</span>
                <span class="status-item">UTF-8</span>
                <span class="status-item">JSON</span>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="bi bi-check-circle"></i>
        <span id="toastMessage">Copied to clipboard!</span>
    </div>

    <script>
        // Sample JSON data
        const sampleJson = {
            "id": "form-employee-survey",
            "name": "Employee Satisfaction Survey",
            "titleEn": "Employee Satisfaction Survey 2024",
            "titleFr": "Sondage sur la satisfaction des employes 2024",
            "version": "1.0.0",
            "tableName": "EmployeeSurvey",
            "schemaName": "Forms",
            "fields": [
                {
                    "id": "field-001",
                    "type": "Text",
                    "labelEn": "Full Name",
                    "labelFr": "Nom complet",
                    "isRequired": true,
                    "sortOrder": 1,
                    "columnName": "FullName",
                    "columnType": "NVARCHAR(255)"
                },
                {
                    "id": "field-002",
                    "type": "Email",
                    "labelEn": "Email Address",
                    "labelFr": "Adresse courriel",
                    "isRequired": true,
                    "sortOrder": 2,
                    "validation": {
                        "pattern": "^[^@]+@[^@]+\\.[^@]+$",
                        "message": "Please enter a valid email"
                    }
                },
                {
                    "id": "field-003",
                    "type": "Select",
                    "labelEn": "Department",
                    "labelFr": "Departement",
                    "isRequired": true,
                    "sortOrder": 3,
                    "options": [
                        { "value": "hr", "labelEn": "Human Resources", "labelFr": "Ressources humaines" },
                        { "value": "it", "labelEn": "Information Technology", "labelFr": "Technologies de l'information" },
                        { "value": "finance", "labelEn": "Finance", "labelFr": "Finances" },
                        { "value": "ops", "labelEn": "Operations", "labelFr": "Operations" }
                    ]
                },
                {
                    "id": "field-004",
                    "type": "Radio",
                    "labelEn": "Overall Satisfaction",
                    "labelFr": "Satisfaction globale",
                    "isRequired": true,
                    "sortOrder": 4,
                    "options": [
                        { "value": "5", "labelEn": "Very Satisfied", "labelFr": "Tres satisfait" },
                        { "value": "4", "labelEn": "Satisfied", "labelFr": "Satisfait" },
                        { "value": "3", "labelEn": "Neutral", "labelFr": "Neutre" },
                        { "value": "2", "labelEn": "Dissatisfied", "labelFr": "Insatisfait" },
                        { "value": "1", "labelEn": "Very Dissatisfied", "labelFr": "Tres insatisfait" }
                    ]
                },
                {
                    "id": "field-005",
                    "type": "TextArea",
                    "labelEn": "Additional Comments",
                    "labelFr": "Commentaires supplementaires",
                    "isRequired": false,
                    "sortOrder": 5,
                    "helpTextEn": "Share any additional feedback",
                    "helpTextFr": "Partagez vos commentaires supplementaires"
                }
            ],
            "metadata": {
                "createdBy": "admin@example.com",
                "createdAt": "2024-01-15T10:30:00Z",
                "updatedAt": "2024-01-20T14:45:00Z",
                "status": "Published"
            }
        };

        let currentViewMode = 'formatted';
        let collapsedPaths = new Set();

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderJson();
            setupKeyboardShortcuts();
        });

        function renderJson() {
            const content = document.getElementById('jsonContent');
            const lineNumbers = document.getElementById('lineNumbers');

            const formatted = JSON.stringify(sampleJson, null, 2);
            const lines = formatted.split('\n');

            // Render line numbers
            lineNumbers.innerHTML = lines.map((_, i) =>
                `<div class="line-number">${i + 1}</div>`
            ).join('');

            // Render JSON with syntax highlighting
            content.innerHTML = highlightJson(formatted);

            // Update minimap
            document.getElementById('minimapContent').textContent = formatted;
        }

        function highlightJson(json) {
            // Simple syntax highlighting
            return json
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                // Keys
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span>:')
                // Strings (after keys to avoid double-matching)
                .replace(/: "([^"]*)"/g, ': <span class="json-string">"$1"</span>')
                // Numbers
                .replace(/: (\d+)/g, ': <span class="json-number">$1</span>')
                // Booleans
                .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                // Null
                .replace(/: (null)/g, ': <span class="json-null">$1</span>')
                // Brackets
                .replace(/([{}\[\]])/g, '<span class="json-bracket">$1</span>');
        }

        function setViewMode(mode) {
            currentViewMode = mode;

            // Update toggle buttons
            document.querySelectorAll('.view-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide views
            const editorArea = document.getElementById('editorArea');
            const diffView = document.getElementById('diffView');

            if (mode === 'diff') {
                editorArea.style.display = 'none';
                diffView.classList.add('active');
            } else {
                editorArea.style.display = 'flex';
                diffView.classList.remove('active');
            }
        }

        function toggleSearch() {
            const searchBar = document.getElementById('searchBar');
            searchBar.classList.toggle('hidden');
            if (!searchBar.classList.contains('hidden')) {
                document.getElementById('searchInput').focus();
            }
        }

        function toggleValidation() {
            const panel = document.getElementById('validationPanel');
            panel.classList.toggle('hidden');

            // Update status
            const status = document.getElementById('validationStatus');
            if (!panel.classList.contains('hidden')) {
                status.className = 'status-item status-invalid';
                status.innerHTML = '<i class="bi bi-x-circle-fill"></i> 2 Errors';
            } else {
                status.className = 'status-item status-valid';
                status.innerHTML = '<i class="bi bi-check-circle-fill"></i> Valid JSON';
            }
        }

        function togglePathNav() {
            document.getElementById('pathNav').classList.toggle('hidden');
        }

        function copyJson() {
            navigator.clipboard.writeText(JSON.stringify(sampleJson, null, 2)).then(() => {
                showToast('Copied to clipboard!', 'success');
            });
        }

        function downloadJson() {
            const blob = new Blob([JSON.stringify(sampleJson, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'form-schema.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Downloaded form-schema.json', 'success');
        }

        function importJson() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    showToast(`Importing ${file.name}...`, 'success');
                }
            };
            input.click();
        }

        function formatJson() {
            showToast('JSON formatted', 'success');
        }

        function collapseAll() {
            showToast('All sections collapsed', 'success');
        }

        function expandAll() {
            showToast('All sections expanded', 'success');
        }

        function goToLine(line) {
            showToast(`Navigated to line ${line}`, 'success');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');

            toast.className = `toast ${type}`;
            toastMessage.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    toggleSearch();
                }
            });
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            body.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
        }
    </script>
</body>
</html>
